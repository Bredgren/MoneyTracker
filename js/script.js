// Generated by CoffeeScript 1.8.0
(function() {
  var Main, loadUrl,
    __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; };

  loadUrl = function(url, callback) {
    return $.getJSON(url, callback);
  };

  Main = (function() {
    Main.prototype.scope = "https://spreadsheets.google.com/feeds";

    Main.prototype.access = "private/full?alt=json-in-script&access_token=";

    Main.prototype.clientId = "225160616080-rlae3dprbofq5i1etegg5vdvobf2rhqi.apps.googleusercontent.com";

    Main.prototype.apiKey = "14OPwgdy9-2uTIS-x5CDMOYcn2Yo2kuML3Fn0tVMdWrA";

    function Main() {
      this.newApiKey = __bind(this.newApiKey, this);
      this.handleWorksheetData = __bind(this.handleWorksheetData, this);
      this.worksheetUrl = __bind(this.worksheetUrl, this);
      this.worksheetDataUrl = __bind(this.worksheetDataUrl, this);
      var apiKey;
      this.data = {};
      apiKey = localStorage["apiKey"];
      this.newApiKey(this.apiKey);
    }

    Main.prototype.worksheetDataUrl = function() {
      var token, url;
      token = gapi.auth.getToken().access_token;
      url = this.scope + "/worksheets/" + this.apiKey + "/" + this.access + token + "&callback=?";
      return url;
    };

    Main.prototype.worksheetUrl = function(worksheetId) {
      var token, url;
      token = gapi.auth.getToken().access_token;
      url = this.scope + this.apiKey + "/" + worksheetId + this.access + token;
      return url;
    };

    Main.prototype.handleWorksheetData = function(jsonData) {
      var id, sections, worksheetData, _i, _len, _ref, _results;
      console.log("handleWorksheetData", jsonData);
      _ref = jsonData.feed.entry;
      _results = [];
      for (_i = 0, _len = _ref.length; _i < _len; _i++) {
        worksheetData = _ref[_i];
        sections = worksheetData.id.$t.split("/");
        id = sections[sections.length - 1];
        _results.push(console.log(id, this.worksheetUrl(id)));
      }
      return _results;
    };

    Main.prototype.newApiKey = function(key) {
      var config;
      console.log("newApiKey", key);
      this.apiKey = key;
      config = {
        'client_id': this.clientId,
        'scope': this.scope
      };
      this.data = {};
      return gapi.auth.authorize(config, (function(_this) {
        return function() {
          return loadUrl(_this.worksheetDataUrl(), _this.handleWorksheetData);
        };
      })(this));
    };

    return Main;

  })();

  $("#authorize-button").click(function() {
    var m;
    return m = new Main();
  });

}).call(this);
